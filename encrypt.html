<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Encrypted Note</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 1.5rem;
    }
    .container { max-width: 32rem; margin: 0 auto; }
    h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
    .subtitle { color: #94a3b8; font-size: 0.875rem; margin-bottom: 1.5rem; }
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; align-items: center; }
    .tabs-label { font-size: 0.875rem; color: #94a3b8; margin-right: 0.25rem; }
    .tab {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .tab.active { background: #10b981; color: white; }
    .tab:not(.active) { background: #334155; color: #cbd5e1; }
    .tab:not(.active):hover { background: #475569; }
    .field { margin-bottom: 1rem; }
    label { display: block; font-size: 0.875rem; margin-bottom: 0.25rem; }
    textarea, input[type="password"], input[type="text"] {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 0.5rem;
      color: #e2e8f0;
      font-size: 1rem;
      font-family: inherit;
    }
    textarea:focus, input:focus { outline: none; border-color: #10b981; }
    textarea { resize: none; height: 8rem; }
    .char-count { font-size: 0.75rem; color: #64748b; margin-top: 0.25rem; }
    .strength-bar { display: flex; gap: 0.25rem; margin-top: 0.5rem; }
    .strength-segment { height: 4px; flex: 1; border-radius: 2px; background: #334155; }
    .strength-segment.filled.red { background: #ef4444; }
    .strength-segment.filled.yellow { background: #eab308; }
    .strength-segment.filled.green { background: #10b981; }
    .strength-label { font-size: 0.75rem; margin-top: 0.25rem; }
    .strength-label.red { color: #f87171; }
    .strength-label.yellow { color: #facc15; }
    .strength-label.green { color: #34d399; }
    button.primary {
      width: 100%;
      padding: 0.625rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    button.primary.encrypt { background: #10b981; color: white; }
    button.primary.encrypt:hover { background: #34d399; }
    button.primary.decrypt { background: #3b82f6; color: white; }
    button.primary.decrypt:hover { background: #60a5fa; }
    button.primary:disabled { background: #475569; cursor: wait; }
    .result {
      margin-top: 1rem;
      padding: 1rem;
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 0.5rem;
    }
    .result.success { border-color: #10b981; }
    .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .result-title { font-size: 0.875rem; color: #34d399; }
    .copy-btn {
      padding: 0.25rem 0.5rem;
      background: #334155;
      border: none;
      border-radius: 0.25rem;
      color: #cbd5e1;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .copy-btn:hover { background: #475569; }
    .url-display {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: #0f172a;
      padding: 0.5rem;
      border-radius: 0.25rem;
      word-break: break-all;
      color: #cbd5e1;
    }
    .result-note { font-size: 0.75rem; color: #64748b; margin-top: 0.5rem; }
    .url-warning { color: #facc15; font-size: 0.8rem; }
    .decrypted-text { white-space: pre-wrap; color: #f1f5f9; }
    .secure-area {
      margin-top: 1rem;
      border-radius: 0.5rem;
      overflow: hidden;
      border: 1px solid #10b981;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
    }
    .secure-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(16, 185, 129, 0.15);
      border-bottom: 1px solid rgba(16, 185, 129, 0.3);
    }
    .secure-header.encrypted {
      background: rgba(59, 130, 246, 0.15);
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }
    .secure-area.encrypted-area {
      border-color: #3b82f6;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
    }
    .secure-header.encrypted .secure-title {
      color: #60a5fa;
    }
    .secure-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #34d399;
    }
    .secure-content {
      padding: 0.75rem;
      white-space: pre-wrap;
      color: #f1f5f9;
      font-family: ui-monospace, monospace;
      font-size: 0.875rem;
      max-height: 12rem;
      overflow-y: auto;
    }
    .error {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(127, 29, 29, 0.5);
      border: 1px solid #b91c1c;
      border-radius: 0.5rem;
      color: #fca5a5;
      font-size: 0.875rem;
    }
    .info-box {
      margin-top: 2rem;
      padding: 1rem;
      background: rgba(30, 41, 59, 0.5);
      border-radius: 0.5rem;
      font-size: 0.75rem;
      color: #94a3b8;
    }
    .info-box strong { display: block; margin-bottom: 0.5rem; }
    .info-box ul { margin-left: 1rem; }
    .info-box li { margin-bottom: 0.25rem; }
    .hidden { display: none; }
    .password-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .password-row input { flex: 1; }
    .eye-btn {
      padding: 0.5rem;
      background: #334155;
      border: 1px solid #475569;
      border-radius: 0.5rem;
      color: #94a3b8;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .eye-btn:hover { background: #475569; color: #cbd5e1; }
    .password-match { font-size: 0.75rem; margin-top: 0.25rem; }
    .password-match.match { color: #34d399; }
    .password-match.no-match { color: #f87171; }
    .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem; }
    .label-row label { margin-bottom: 0; }
    .label-buttons { display: flex; gap: 0.5rem; }
    .small-btn {
      padding: 0.125rem 0.375rem;
      background: #334155;
      border: none;
      border-radius: 0.25rem;
      color: #94a3b8;
      font-size: 0.7rem;
      cursor: pointer;
    }
    .small-btn:hover { background: #475569; color: #cbd5e1; }
    .error-action-row { text-align: center; margin-top: 0.5rem; }
    .error-action {
      padding: 0.25rem 0.5rem;
      background: transparent;
      border: 1px solid #fca5a5;
      border-radius: 0.25rem;
      color: #fca5a5;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .error-action:hover { background: rgba(252, 165, 165, 0.1); }
    .toast {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.625rem 1rem;
      background: #10b981;
      color: white;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .toast.visible { opacity: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Encrypted Note</h1>
    <p class="subtitle">Encrypt a short note with a password. Everything happens in your browser - nothing is sent to the server by default.</p>

    <div class="tabs">
      <span class="tabs-label">Mode:</span>
      <button class="tab active" id="tab-encrypt" onclick="switchTab('encrypt')">Encrypt</button>
      <button class="tab" id="tab-decrypt" onclick="switchTab('decrypt')">Decrypt</button>
    </div>

    <!-- Encrypt Panel - fields injected by JS -->
    <div id="panel-encrypt"></div>

    <!-- Decrypt Panel - fields injected by JS -->
    <div id="panel-decrypt" class="hidden"></div>

    <div class="error hidden" id="error"></div>
    <div class="toast hidden" id="toast"></div>

    <div class="info-box">
      <strong>How it works:</strong>
      <ul>
        <li>Uses PBKDF2-SHA512 (200k iterations) to derive a key from your password</li>
        <li>SHA-512 is harder for GPUs to crack than SHA-256</li>
        <li>Encrypts with AES-256-GCM (includes integrity check)</li>
        <li>Stores salt + IV + ciphertext in URL-safe base64</li>
        <li>Everything happens in your browser - nothing is sent to the server by default</li>
      </ul>
    </div>
  </div>

  <script>
    // State for restore functionality
    let savedNote = null;
    let passwordVerified = false;

    // Generate form fields dynamically to prevent browser tab restore
    function initForms() {
      // Encrypt panel
      document.getElementById('panel-encrypt').innerHTML = `
        <div class="field">
          <div class="label-row">
            <label for="note">Your Note</label>
            <div class="label-buttons">
              <button type="button" class="small-btn hidden" id="btn-restore" onclick="restoreNote()">Restore</button>
              <button type="button" class="small-btn" id="btn-clear" onclick="clearNote()">Clear</button>
            </div>
          </div>
          <textarea id="note" placeholder="Enter your secret note..." oninput="updateCharCount()"></textarea>
          <div class="char-count"><span id="char-count">0</span> characters</div>
        </div>
        <div class="field" id="password-field">
          <label for="password-encrypt">Password</label>
          <div class="password-row">
            <button type="button" class="eye-btn" id="toggle-visibility" onclick="togglePasswordVisibility()" title="Show password">
              <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
              <svg id="eye-off-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
            </button>
            <input type="password" id="password-encrypt" placeholder="Enter a strong password" oninput="updateStrength()">
          </div>
          <div id="confirm-field">
            <input type="password" id="password-confirm" placeholder="Confirm password" oninput="checkMatch()" style="margin-top: 0.5rem;">
            <div class="password-match" id="password-match"></div>
          </div>
          <div class="strength-bar" id="strength-bar"></div>
          <div class="strength-label" id="strength-label"></div>
        </div>
        <button class="primary encrypt" id="btn-encrypt" onclick="encrypt()">Encrypt &amp; Generate URL</button>
        <div class="result hidden" id="encrypt-result">
          <div class="result-header">
            <span class="result-title" id="url-result-title">Generated URL:</span>
            <div id="url-buttons">
              <button class="copy-btn" onclick="openUrl()" style="margin-right: 0.5rem;">Open</button>
              <button class="copy-btn" onclick="copyUrl(event)">Copy</button>
            </div>
          </div>
          <div class="url-display" id="generated-url"></div>
          <div class="result-note" id="url-result-note">Share this URL + password separately. The # fragment is never sent to servers.</div>
        </div>
        <div class="secure-area encrypted-area hidden" id="encrypted-content-area">
          <div class="secure-header encrypted">
            <span class="secure-title">üîí Encrypted Content</span>
            <button class="copy-btn" onclick="copyEncrypted(event)">Copy</button>
          </div>
          <div class="secure-content" id="encrypted-content"></div>
        </div>
      `;

      // Decrypt panel
      document.getElementById('panel-decrypt').innerHTML = `
        <div class="field">
          <label for="encrypted-data">Encrypted Data or URL</label>
          <textarea id="encrypted-data" placeholder="Paste the URL or encrypted string..." style="height: 6rem; font-family: ui-monospace, monospace; font-size: 0.875rem;"></textarea>
        </div>
        <div class="field">
          <label for="password-decrypt">Password</label>
          <input type="password" id="password-decrypt" placeholder="Enter the password">
        </div>
        <button class="primary decrypt" id="btn-decrypt" onclick="decrypt()">Decrypt Note</button>
        <div class="secure-area hidden" id="decrypt-result">
          <div class="secure-header">
            <span class="secure-title">üîì Decrypted Note</span>
            <button class="copy-btn" onclick="copyDecrypted(event)">Copy</button>
          </div>
          <div class="secure-content" id="decrypted-text"></div>
        </div>
      `;
    }

    // Initialize on load, then check for hash
    window.addEventListener('DOMContentLoaded', () => {
      initForms();
      
      const hash = window.location.hash.slice(1);
      if (hash) {
        document.getElementById('encrypted-data').value = hash;
        switchTab('decrypt');
      }
    });

    function switchTab(tab) {
      document.getElementById('tab-encrypt').classList.toggle('active', tab === 'encrypt');
      document.getElementById('tab-decrypt').classList.toggle('active', tab === 'decrypt');
      document.getElementById('panel-encrypt').classList.toggle('hidden', tab !== 'encrypt');
      document.getElementById('panel-decrypt').classList.toggle('hidden', tab !== 'decrypt');
      hideError();
    }

    function updateCharCount() {
      const count = document.getElementById('note').value.length;
      document.getElementById('char-count').textContent = count;
    }

    function getStrength(pw) {
      if (!pw) return { score: 0, label: '', color: '' };
      let score = 0;
      if (pw.length >= 8) score++;
      if (pw.length >= 12) score++;
      if (pw.length >= 16) score++;
      if (/[a-z]/.test(pw) && /[A-Z]/.test(pw)) score++;
      if (/\d/.test(pw)) score++;
      if (/[^a-zA-Z0-9]/.test(pw)) score++;
      
      if (score <= 2) return { score, label: 'Weak', color: 'red' };
      if (score <= 4) return { score, label: 'Moderate', color: 'yellow' };
      return { score, label: 'Strong', color: 'green' };
    }

    function updateStrength() {
      const pw = document.getElementById('password-encrypt').value;
      const pwField = document.getElementById('password-encrypt');
      const strength = getStrength(pw);
      const bar = document.getElementById('strength-bar');
      const label = document.getElementById('strength-label');
      
      bar.innerHTML = [1,2,3,4,5,6].map(i => 
        `<div class="strength-segment ${i <= strength.score ? 'filled ' + strength.color : ''}"></div>`
      ).join('');
      
      label.textContent = strength.label;
      label.className = 'strength-label ' + strength.color;
      
      // If password was verified but user is now changing it in hidden mode, re-require confirmation
      if (passwordVerified && pwField.type === 'password') {
        const confirmField = document.getElementById('confirm-field');
        if (!confirmField) {
          // Add confirmation field back
          const confirmDiv = document.createElement('div');
          confirmDiv.id = 'confirm-field';
          confirmDiv.innerHTML = `
            <input type="password" id="password-confirm" placeholder="Confirm password" oninput="checkMatch()" style="margin-top: 0.5rem;">
            <div class="password-match" id="password-match"></div>
          `;
          bar.parentElement.insertBefore(confirmDiv, bar);
        }
        passwordVerified = false;
      }
      
      // Also check match if confirm field exists
      checkMatch();
    }

    function checkMatch() {
      const confirmField = document.getElementById('password-confirm');
      const matchDiv = document.getElementById('password-match');
      if (!confirmField || !matchDiv) return;
      
      const pw = document.getElementById('password-encrypt').value;
      const confirm = confirmField.value;
      
      if (!confirm) {
        matchDiv.textContent = '';
        matchDiv.className = 'password-match';
      } else if (pw === confirm) {
        matchDiv.textContent = '‚úì Passwords match';
        matchDiv.className = 'password-match match';
      } else {
        matchDiv.textContent = '‚úó Passwords do not match';
        matchDiv.className = 'password-match no-match';
      }
    }

    function togglePasswordVisibility() {
      const pwField = document.getElementById('password-encrypt');
      const confirmFieldWrapper = document.getElementById('confirm-field');
      const eyeIcon = document.getElementById('eye-icon');
      const eyeOffIcon = document.getElementById('eye-off-icon');
      const toggleBtn = document.getElementById('toggle-visibility');
      
      if (pwField.type === 'password') {
        // Switching to visible mode
        pwField.type = 'text';
        if (confirmFieldWrapper) {
          confirmFieldWrapper.remove();
        }
        eyeIcon.classList.add('hidden');
        eyeOffIcon.classList.remove('hidden');
        toggleBtn.title = 'Hide password';
        passwordVerified = true; // Visible = verified
      } else {
        // Switching to hidden mode (already verified visually)
        pwField.type = 'password';
        eyeIcon.classList.remove('hidden');
        eyeOffIcon.classList.add('hidden');
        toggleBtn.title = 'Show password';
        // No confirm field needed - was already verified visually
      }
    }

    function setVerifiedPasswordState() {
      const pwField = document.getElementById('password-encrypt');
      const confirmFieldWrapper = document.getElementById('confirm-field');
      const eyeIcon = document.getElementById('eye-icon');
      const eyeOffIcon = document.getElementById('eye-off-icon');
      const toggleBtn = document.getElementById('toggle-visibility');
      
      // Convert to single hidden password field
      pwField.type = 'password';
      if (confirmFieldWrapper) {
        confirmFieldWrapper.remove();
      }
      eyeIcon.classList.remove('hidden');
      eyeOffIcon.classList.add('hidden');
      toggleBtn.title = 'Show password';
      passwordVerified = true;
    }

    function restoreNote() {
      if (savedNote !== null) {
        document.getElementById('note').value = savedNote;
        updateCharCount();
        document.getElementById('btn-restore').classList.add('hidden');
        savedNote = null;
      }
    }

    function clearNote() {
      document.getElementById('note').value = '';
      updateCharCount();
    }

    function showError(msg, actionBtn = null) {
      const el = document.getElementById('error');
      if (actionBtn) {
        el.innerHTML = `${msg}<div class="error-action-row"><button class="error-action" onclick="${actionBtn.onclick}">${actionBtn.label}</button></div>`;
      } else {
        el.textContent = msg;
      }
      el.classList.remove('hidden');
    }

    function hideError() {
      document.getElementById('error').classList.add('hidden');
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('visible'), 10);
      setTimeout(() => {
        toast.classList.remove('visible');
        setTimeout(() => toast.classList.add('hidden'), 200);
      }, 2000);
    }

    async function deriveKey(password, salt) {
      const keyMaterial = await crypto.subtle.importKey(
        'raw',
        new TextEncoder().encode(password),
        'PBKDF2',
        false,
        ['deriveKey']
      );
      return crypto.subtle.deriveKey(
        { name: 'PBKDF2', salt, iterations: 200000, hash: 'SHA-512' },
        keyMaterial,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt', 'decrypt']
      );
    }

    async function encrypt(forceWeak = false) {
      const note = document.getElementById('note').value.trim();
      const password = document.getElementById('password-encrypt').value;
      const confirmField = document.getElementById('password-confirm');
      const strength = getStrength(password);

      hideError();
      document.getElementById('encrypt-result').classList.add('hidden');
      document.getElementById('encrypted-content-area').classList.add('hidden');

      if (!note || !password) {
        showError('Please enter both a note and password');
        return;
      }
      
      // Check password confirmation if not yet verified
      if (!passwordVerified && confirmField) {
        const confirm = confirmField.value;
        if (password !== confirm) {
          showError('Passwords do not match');
          return;
        }
      }
      
      if (!forceWeak && strength.score < 3) {
        showError('Weak password - consider 12+ chars, mixed case, numbers, symbols.', {
          label: 'Encrypt anyway',
          onclick: 'encrypt(true)'
        });
        return;
      }

      const btn = document.getElementById('btn-encrypt');
      btn.disabled = true;
      btn.textContent = 'Encrypting...';

      try {
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const key = await deriveKey(password, salt);

        const ciphertext = await crypto.subtle.encrypt(
          { name: 'AES-GCM', iv },
          key,
          new TextEncoder().encode(note)
        );

        const combined = new Uint8Array([...salt, ...iv, ...new Uint8Array(ciphertext)]);
        const base64 = btoa(String.fromCharCode(...combined))
          .replace(/\+/g, '-')
          .replace(/\//g, '_')
          .replace(/=+$/, '');

        const url = `${window.location.origin}${window.location.pathname}#${base64}`;
        
        // Check if URL is too long (2000 chars is safe limit for most browsers)
        if (url.length > 2000) {
          document.getElementById('url-result-title').textContent = 'URL Not Available:';
          document.getElementById('generated-url').innerHTML = `<span class="url-warning">Encrypted URL would be too long. (${url.length} chars &gt; 2000 chars max)<br>Copy the encrypted content below instead or reduce the content of the note.</span>`;
          document.getElementById('url-buttons').classList.add('hidden');
          document.getElementById('url-result-note').textContent = 'Paste the encrypted content into the decrypt field along with the password.';
        } else {
          document.getElementById('url-result-title').textContent = 'Generated URL:';
          document.getElementById('generated-url').textContent = url;
          document.getElementById('url-buttons').classList.remove('hidden');
          document.getElementById('url-result-note').textContent = 'Share this URL + password separately. The # fragment is never sent to servers.';
        }
        document.getElementById('encrypt-result').classList.remove('hidden');
        
        // Always show encrypted content
        document.getElementById('encrypted-content').textContent = base64;
        document.getElementById('encrypted-content-area').classList.remove('hidden');
        
        // Save note for restore, clear the field
        savedNote = note;
        document.getElementById('note').value = '';
        updateCharCount();
        
        // Convert to verified password state (single hidden field)
        setVerifiedPasswordState();
        
        // Show restore button
        document.getElementById('btn-restore').classList.remove('hidden');
        
      } catch (e) {
        showError('Encryption failed: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Encrypt & Generate URL';
      }
    }

    async function decrypt() {
      let data = document.getElementById('encrypted-data').value.trim();
      const password = document.getElementById('password-decrypt').value;

      hideError();
      document.getElementById('decrypt-result').classList.add('hidden');

      // Extract hash from URL if pasted
      if (data.includes('#')) {
        data = data.split('#').pop();
      }

      if (!data || !password) {
        showError('Please enter both encrypted data and password');
        return;
      }

      const btn = document.getElementById('btn-decrypt');
      btn.disabled = true;
      btn.textContent = 'Decrypting...';

      try {
        // Restore standard base64
        let base64 = data.replace(/-/g, '+').replace(/_/g, '/');
        while (base64.length % 4) base64 += '=';

        const combined = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
        const salt = combined.slice(0, 16);
        const iv = combined.slice(16, 28);
        const ciphertext = combined.slice(28);

        const key = await deriveKey(password, salt);

        const plaintext = await crypto.subtle.decrypt(
          { name: 'AES-GCM', iv },
          key,
          ciphertext
        );

        document.getElementById('decrypted-text').textContent = new TextDecoder().decode(plaintext);
        document.getElementById('decrypt-result').classList.remove('hidden');
      } catch (e) {
        showError('Decryption failed. Wrong password or corrupted data.');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Decrypt Note';
      }
    }

    async function copyUrl(e) {
      const url = document.getElementById('generated-url').textContent;
      await navigator.clipboard.writeText(url);
      e.target.textContent = '‚úì Copied!';
      setTimeout(() => e.target.textContent = 'Copy', 2000);
      showToast('‚úì URL copied to clipboard');
    }

    async function copyDecrypted(e) {
      const text = document.getElementById('decrypted-text').textContent;
      await navigator.clipboard.writeText(text);
      e.target.textContent = '‚úì Copied!';
      setTimeout(() => e.target.textContent = 'Copy', 2000);
      showToast('‚úì Decrypted note copied to clipboard');
    }

    async function copyEncrypted(e) {
      const text = document.getElementById('encrypted-content').textContent;
      await navigator.clipboard.writeText(text);
      e.target.textContent = '‚úì Copied!';
      setTimeout(() => e.target.textContent = 'Copy', 2000);
      showToast('‚úì Encrypted content copied to clipboard');
    }

    function openUrl() {
      const url = document.getElementById('generated-url').textContent;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
